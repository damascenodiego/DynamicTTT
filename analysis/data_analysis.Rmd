---
title: "Statistical analysis of the Dynamic TTT method"
output: html_notebook
---

<!-- 
This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code.  

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*.  
-->

```{r, message=FALSE}
options(digits=2)

source('./utils.R')
rm(list.of.packages,new.packages)

# load the csv files

dirs <- list.dirs(path="../results/dfa/data/WP/", recursive=FALSE)

ldf <- list() # creates a list
count <- 1
for (i in dirs) {
  change_method <- strsplit(i,"//")[[1]][2]
  files <- list.files(path=i, pattern="*.csv", full.names=TRUE, recursive=FALSE)
  # print(files)
  
  for (file in files) {
    f_csv = read.csv(file, header=TRUE)
    f_control <- f_csv[f_csv$algorithm=='dfa/TTT',2:8]
    f_treatmt <- f_csv[!f_csv$algorithm=='dfa/TTT',c(2,5:8)]
    f_merged <- merge(f_control,f_treatmt, by=1, 
                      suffixes = c('_ttt', '_dyn'), 
                      all=TRUE)
    tot_na <- max(sapply(f_merged, function(x) sum(is.na(x))))
    if(tot_na>0){
      warning("WARNING: ", tot_na, " entries dropped from file '", file, "'\n")
    }
    f_merged <- drop_na(f_merged)
    f_merged$change <- change_method
    ldf[[count]] <- f_merged
    count<- count+1
  }
  
}
rm(f_csv,count,file,i,change_method,dirs,files)
rm(f_control,f_treatmt,f_merged, tot_na)
ldf <- do.call(rbind, ldf)

```

```{r}

# calculate the wilcox test 
for (the_col in c("eq_count","mq_count")) {
  print(paste("########################", the_col, "########################"))
  for (a_ch in unique(ldf$change)) {
    # for (a_ch in unique(ldf$change)) 
      {
        sdf <- ldf[ldf$change == a_ch,]
        
        print(paste("##", a_ch, "##"))
        
        control<-sdf[, paste(the_col,"_ttt",sep = "")]
        treatmt<-sdf[, paste(the_col,"_dyn",sep = "")]
        
        wilc<-wilcox.test(control, treatmt, paired = TRUE)
        d <- (c(control, treatmt))
        
        name_control<-"dfa/TTT"
        name_treatmt<-"dfa/dynamicTTT"
        f <- c(rep(c(name_control),each=length(control)) , rep(c(name_treatmt),each=length(treatmt)))
        
        print(paste(the_col,"@",name_control,"vs.",name_treatmt,":",wilc$p.value))
        ## compute effect sizes
        # print(cliff.delta(d,f))
        # print(cohen.d(d,f))
        print(VD.A(d,f))
        
        rm(sdf,control, treatmt)
        rm(name_control, name_treatmt)
        rm(d, f)
        
      }
    # break
  }
  print("##########################################################")
}


```
